{% extends "layout.html" %} {% block title %}Admin Dashboard - Household
Services{% endblock %} {% block content %}
<h2>Admin Dashboard</h2>
<div class="flex-md-row d-flex justify-content-between align-item-center">
  <div class="">
    <a href="" class="btn btn-secondary btn-block">Home</a>
  </div>
  <div class="">
    <a href="" class="btn btn-secondary btn-block">Search</a>
  </div>
  <div class="">
    <a href="" class="btn btn-secondary btn-block">Summary</a>
  </div>
  <div class="">
    <a href="{{ url_for('logout') }}" class="btn btn-secondary btn-block"
      >LogOut</a
    >
  </div>
</div>
<!-- Table -->
<div class="container mt-4">
  <h3>Services</h3>
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Service Name</th>
        <th>Base Price</th>
        <th>Description</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Sample data, replace with your dynamic data from the database -->
      {% for service in services %}
      <tr>
        <td>{{service.id}}</td>
        <td>{{service.service_name}}</td>
        <td>{{service.price}}</td>
        <td>{{service.description}}</td>
        <td>
          <button
            class="btn btn-warning btn-sm"
            onclick="openEditModal('{{ service.id }}, {{ service.service_name }}, {{ service.description }}, {{ service.price }}')"
          >
            Edit
          </button>
          <!-- <a href="#" class="btn btn-danger btn-sm">Delete</a> -->
          <form
            action="{{ url_for('delete_service', service_id=service.id) }}"
            method="post"
            onsubmit="return confirm('Are you sure you want to delete this service?');"
            style="display: contents"
          >
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Add New Service -->
  <!-- Button to Open the Modal -->
  <button id="addServiceBtn" class="btn btn-primary mb-3" onclick="openModal()">
    Add New Service
  </button>

  <!-- The Modal -->
  <div id="addServiceModal" style="display: none">
    <div class="modal-content">
      <span class="close" id="closeModal" style="cursor: pointer">&times;</span>
      <h3>Add New Service</h3>
      <form
        id="serviceForm"
        action="{{ url_for('add_service') }}"
        method="POST"
      >
        <input
          type="text"
          id="service_name"
          placeholder="Service Name"
          name="service_name"
          class="form-control"
          required
        />

        <textarea
          class="form-control"
          name="service_description"
          placeholder="Description"
        ></textarea>
        <input
          type="number"
          id="base_price"
          class="form-control"
          placeholder="Base Price"
          name="base_price"
          required
        />
        <input
          type="number"
          id="time_required"
          placeholder="Time Required"
          name="time_required"
          class="form-control"
          required
        />
        <button type="submit" class="btn btn-secondary mb-2">
          Add Service
        </button>
        <button
          type="button"
          onclick="closeModal()"
          id="cancelBtn"
          class="btn btn-secondary mb-2"
        >
          Cancel
        </button>
      </form>
    </div>
  </div>

  <h3>Professionals</h3>
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Experience</th>
        <th>Service Name</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Sample data, replace with your dynamic data from the database -->
      {% for professional in professionals %}
      <tr>
        <td>{{professional.id}}</td>
        <td>{{professional.user.name}}</td>
        <td>{{professional.experience}}</td>
        <td>{{professional.service_name}}</td>
        <td>
          <a href="#" class="btn btn-warning btn-sm">Edit</a>
          <form
            action="{{ url_for('delete_professional', professional_id=professional.id) }}"
            method="post"
            onsubmit="return confirm('Are you sure you want to delete this professional?');"
            style="display: contents"
          >
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>Customers</h3>
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Address</th>
        <th>Contact</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Sample data, replace with your dynamic data from the database -->
      {% for customer in customers %}
      <tr>
        <td>{{customer.id}}</td>
        <td>{{customer.user.name}}</td>
        <td>{{customer.address}}</td>
        <td>{{customer.contact}}</td>
        <td>
          <a href="#" class="btn btn-warning btn-sm">Edit</a>
          <form
            action="{{ url_for('delete_customer', customer_id=customer.id) }}"
            method="post"
            onsubmit="return confirm('Are you sure you want to delete this service?');"
            style="display: contents"
          >
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>Service Requests</h3>
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Requested By</th>
        <th>Assigned Professional</th>
        <th>Requested Date</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <!-- Sample data, replace with your dynamic data from the database -->
      {% for service_request in service_requests %}
      <tr>
        <td>{{service_request.id}}</td>
        <td>
          {{ service_request.customer.user.name if service_request.professional
          else 'N/A' }}
        </td>
        <td>
          {{ service_request.professional.user.name if
          service_request.professional else 'N/A' }}
        </td>
        <td>{{service_request.date_of_request.strftime('%Y-%m-%d') }}</td>
        <td>{{service_request.status}}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="editServiceModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="editServiceModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form
        id="editServiceForm"
        action="{{ url_for('update_service') }}"
        method="POST"
      >
        <div class="modal-header">
          <h5 class="modal-title" id="editServiceModalLabel">Edit Service</h5>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editServiceId" name="service_id" />
          <div class="form-group">
            <label for="editServiceName">Service Name</label>
            <input
              type="text"
              class="form-control"
              id="editServiceName"
              name="service_name"
              required
            />
          </div>
          <div class="form-group">
            <label for="editDescription">Description</label>
            <textarea
              class="form-control"
              id="editDescription"
              name="description"
              required
            ></textarea>
          </div>
          <div class="form-group">
            <label for="editPrice">Price</label>
            <input
              type="number"
              class="form-control"
              id="editPrice"
              name="price"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Close
          </button>
          <button type="submit" class="btn btn-success">Update Service</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function closeModal() {
    document.getElementById("addServiceModal").style.display = "none";
  }
  function openModal() {
    document.getElementById("addServiceModal").style.display = "block";
  }
  function openEditModal(id, name, description, price) {
    // Show the modal
    let data = id.split(", ").map((part) => part.trim());

    document.getElementById("editServiceModalLabel").innerHTML =
      "Edit Service #" + data[0];
    document.getElementById("editServiceId").value = data[0];
    document.getElementById("editServiceName").value = data[1];
    document.getElementById("editDescription").value = data[2];
    document.getElementById("editPrice").value = data[3];
    $("#editServiceModal").modal("show");
  }
</script>
{% endblock %}
